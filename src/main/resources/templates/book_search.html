<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Book Search</title>
</head>
<body>
<h2>Book Search</h2>

<!-- Search Form -->
<form id="searchForm" action="#" th:action="@{/books/search}" method="get">
    <div>
        <label for="query">Search Query:</label>
        <input type="text" id="query" name="query" th:value="${query}" />
    </div>

    <div>
        <label for="searchBy">Search By:</label>
        <select id="searchBy" name="searchBy">
            <option value="title" th:selected="${searchBy == 'title'}">Title</option>
            <option value="author" th:selected="${searchBy == 'author'}">Author</option>
            <!-- Add more search fields as needed -->
        </select>
    </div>

    <button type="submit">Search</button>
</form>

<!-- Results will be shown here, we will use Thymeleaf to display the results dynamically -->
<div id="bookResults"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('#searchForm');
        const resultsDiv = document.querySelector('#bookResults');

        // Handle form submission with AJAX
        form.addEventListener('submit', function (e) {
            e.preventDefault();  // Prevent normal form submission

            const query = document.querySelector('#query').value;
            const searchBy = document.querySelector('#searchBy').value;

            // Show a loading message
            resultsDiv.innerHTML = 'Loading...';

            // Make the AJAX request to the REST controller
            fetch(`/books/search?query=${query}&searchBy=${searchBy}`)
                .then(response => response.json())
                .then(data => {
                    // Dynamically display the results in the #bookResults div
                    let resultsHtml = '<ul>';
                    if (data.content && data.content.length > 0) {
                        data.content.forEach(book => {
                            resultsHtml += `<li>${book.title} by ${book.author}</li>`;
                        });
                    } else {
                        resultsHtml = 'No results found.';
                    }
                    resultsHtml += '</ul>';
                    resultsDiv.innerHTML = resultsHtml;
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                    resultsDiv.innerHTML = 'Error fetching search results.';
                });
        });
    });
</script>
</body>
</html>
